package main

import (
	"fmt"
	"time"
)

func main() {
	fmt.Println("=== Select å¤šè·¯å¤ç”¨ç»ƒä¹  ===")
	fmt.Println("ğŸ’¡ Select æ˜¯ Go å¹¶å‘ç¼–ç¨‹çš„ç‘å£«å†›åˆ€ï¼")

	// ç»ƒä¹  1: Select åŸºç¡€è¯­æ³•
	exercise1()

	// ç»ƒä¹  2: å¤šä¸ª channel é€‰æ‹©
	exercise2()

	// ç»ƒä¹  3: è¶…æ—¶æ§åˆ¶ (Timeout)
	exercise3()

	// ç»ƒä¹  4: éé˜»å¡æ“ä½œ (Default)
	exercise4()

	// ç»ƒä¹  5: å®æˆ˜ - å¤šæ•°æ®æºèšåˆ
	exercise5()
}

// ============================================
// ç»ƒä¹  1: Select åŸºç¡€è¯­æ³• ğŸ¯
// ç›®æ ‡: ç†è§£ select çš„å·¥ä½œåŸç†
// é¢è¯•è€ƒç‚¹: select çš„æ‰§è¡Œæµç¨‹
// ============================================
func exercise1() {
	fmt.Println("\nã€ç»ƒä¹  1ã€‘Select åŸºç¡€è¯­æ³•")

	ch1 := make(chan string)
	ch2 := make(chan string)

	// TODO: å¯åŠ¨ä¸¤ä¸ª goroutineï¼Œåˆ†åˆ«å‘ ch1 å’Œ ch2 å‘é€æ•°æ®
	// goroutine 1: ç­‰å¾… 100ms åå‘é€ "æ¥è‡ª ch1"
	// goroutine 2: ç­‰å¾… 200ms åå‘é€ "æ¥è‡ª ch2"
	// æç¤º:
	// go func() {
	//     time.Sleep(100 * time.Millisecond)
	//     ch1 <- "æ¥è‡ª ch1"
	// }()
	// ä½ çš„ä»£ç :
	go func() {
		time.Sleep(100 * time.Millisecond)
		ch1 <- "ch1 msg"
	}()
	go func() {
		time.Sleep(200 * time.Millisecond)
		ch2 <- "ch2 msg"
	}()

	// TODO: ä½¿ç”¨ select åŒæ—¶ç­‰å¾…ä¸¤ä¸ª channel
	// select {
	// case msg1 := <-ch1:
	//     fmt.Println("æ”¶åˆ°:", msg1)
	// case msg2 := <-ch2:
	//     fmt.Println("æ”¶åˆ°:", msg2)
	// }
	// ä½ çš„ä»£ç :

	//fmt.Println(<-ch1)
	//fmt.Println(<-ch2)
	//wg.Wait()
	select {
	case msg := <-ch1:
		fmt.Println(msg)
	case msg := <-ch2:
		fmt.Println(msg)
	}

	// é—®é¢˜æ€è€ƒ: å“ªä¸ªæ¶ˆæ¯ä¼šå…ˆè¢«æ¥æ”¶ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
}

// ============================================
// ç»ƒä¹  2: å¤šä¸ª channel é€‰æ‹© ğŸ”€
// ç›®æ ‡: Select åŒæ—¶ç›‘å¬å¤šä¸ª channel
// é¢è¯•è€ƒç‚¹: select çš„éšæœºæ€§
// ============================================
func exercise2() {
	fmt.Println("\nã€ç»ƒä¹  2ã€‘å¤šä¸ª Channel é€‰æ‹©")

	//ch1 := make(chan int)
	//ch2 := make(chan int)
	//ch3 := make(chan int)

	// TODO: å¯åŠ¨ä¸‰ä¸ª goroutine
	// æ¯ä¸ª goroutine å‘é€ 3 ä¸ªæ•°å­—ï¼ˆæ¯éš” 50msï¼‰
	// goroutine 1: å‘é€ 1, 2, 3 åˆ° ch1
	// goroutine 2: å‘é€ 10, 20, 30 åˆ° ch2
	// goroutine 3: å‘é€ 100, 200, 300 åˆ° ch3
	// æç¤º:
	// go func() {
	//     for i := 1; i <= 3; i++ {
	//         time.Sleep(50 * time.Millisecond)
	//         ch1 <- i
	//     }
	//     close(ch1)
	// }()
	// ä½ çš„ä»£ç :

	// TODO: ä½¿ç”¨ select å¾ªç¯æ¥æ”¶æ‰€æœ‰æ•°æ®
	// æç¤º: ç”¨ for å¾ªç¯é…åˆ select
	// æ³¨æ„: å½“æŸä¸ª channel å…³é—­åï¼Œå®ƒä¼šä¸€ç›´è¿”å›é›¶å€¼
	//       éœ€è¦å¤„ç†å…³é—­çš„ channelï¼ˆæ£€æŸ¥ okï¼‰
	//
	// for {
	//     select {
	//     case val, ok := <-ch1:
	//         if ok {
	//             fmt.Printf("ch1: %d\n", val)
	//         } else {
	//             ch1 = nil  // é‡è¦ï¼šè®¾ä¸º nil åä¸ä¼šå†è¢« select é€‰ä¸­
	//         }
	//     case val, ok := <-ch2:
	//         // ...
	//     case val, ok := <-ch3:
	//         // ...
	//     }
	//
	//     // å¦‚ä½•åˆ¤æ–­æ‰€æœ‰ channel éƒ½å…³é—­äº†ï¼Ÿ
	//     if ch1 == nil && ch2 == nil && ch3 == nil {
	//         break
	//     }
	// }
	// ä½ çš„ä»£ç :

	// é—®é¢˜æ€è€ƒ:
	// 1. å¦‚æœä¸å°†å…³é—­çš„ channel è®¾ä¸º nil ä¼šæ€æ ·ï¼Ÿ
	// 2. æ•°æ®æ¥æ”¶çš„é¡ºåºæ˜¯ç¡®å®šçš„å—ï¼Ÿ
}

// ============================================
// ç»ƒä¹  3: è¶…æ—¶æ§åˆ¶ â±ï¸
// ç›®æ ‡: ä½¿ç”¨ select å®ç°æ“ä½œè¶…æ—¶
// é¢è¯•è€ƒç‚¹: time.After çš„ä½¿ç”¨ï¼Œè¶…æ—¶å¤„ç†æ¨¡å¼
// ============================================
func exercise3() {
	fmt.Println("\nã€ç»ƒä¹  3ã€‘è¶…æ—¶æ§åˆ¶")

	// åœºæ™¯ 1: å¿«é€Ÿå“åº”ï¼ˆä¸è¶…æ—¶ï¼‰
	fmt.Println("åœºæ™¯ 1: å¿«é€Ÿå“åº”")
	// TODO: åˆ›å»ºä¸€ä¸ª channel
	// ä½ çš„ä»£ç :

	// TODO: å¯åŠ¨ goroutineï¼Œ50ms åå‘é€æ•°æ®
	// ä½ çš„ä»£ç :

	// TODO: ä½¿ç”¨ select å®ç° 100ms è¶…æ—¶
	// å¦‚æœåœ¨ 100ms å†…æ”¶åˆ°æ•°æ®ï¼Œæ‰“å° "æ”¶åˆ°æ•°æ®: ..."
	// å¦‚æœè¶…æ—¶ï¼Œæ‰“å° "è¶…æ—¶äº†ï¼"
	// æç¤º:
	// select {
	// case msg := <-ch:
	//     fmt.Println("æ”¶åˆ°æ•°æ®:", msg)
	// case <-time.After(100 * time.Millisecond):
	//     fmt.Println("è¶…æ—¶äº†ï¼")
	// }
	// ä½ çš„ä»£ç :

	// åœºæ™¯ 2: æ…¢é€Ÿå“åº”ï¼ˆä¼šè¶…æ—¶ï¼‰
	fmt.Println("\nåœºæ™¯ 2: æ…¢é€Ÿå“åº”")
	// TODO: åˆ›å»ºå¦ä¸€ä¸ª channel
	// ä½ çš„ä»£ç :

	// TODO: å¯åŠ¨ goroutineï¼Œ200ms åå‘é€æ•°æ®ï¼ˆæ¯”è¶…æ—¶æ—¶é—´é•¿ï¼‰
	// ä½ çš„ä»£ç :

	// TODO: ä½¿ç”¨ select å®ç° 100ms è¶…æ—¶ï¼ˆå’Œä¸Šé¢ä¸€æ ·ï¼‰
	// ä½ çš„ä»£ç :

	// é—®é¢˜æ€è€ƒ:
	// 1. time.After è¿”å›çš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ
	// 2. å¦‚æœè¶…æ—¶äº†ï¼Œå‘é€æ•°æ®çš„ goroutine ä¼šæ€æ ·ï¼Ÿ

}

// ============================================
// ç»ƒä¹  4: éé˜»å¡æ“ä½œ ğŸš€
// ç›®æ ‡: ä½¿ç”¨ default å®ç°éé˜»å¡çš„ channel æ“ä½œ
// é¢è¯•è€ƒç‚¹: select default çš„ä½¿ç”¨åœºæ™¯
// ============================================
func exercise4() {
	fmt.Println("\nã€ç»ƒä¹  4ã€‘éé˜»å¡æ“ä½œ")

	//ch := make(chan int, 2) // ç¼“å†²å¤§å°ä¸º 2

	// éé˜»å¡å‘é€
	fmt.Println("æµ‹è¯•éé˜»å¡å‘é€:")
	// TODO: ä½¿ç”¨ select + default å®ç°éé˜»å¡å‘é€
	// æˆåŠŸå‘é€ 3 ä¸ªæ•°å­— (1, 2, 3)
	// ç”±äºç¼“å†²åŒºåªæœ‰ 2ï¼Œç¬¬ 3 ä¸ªåº”è¯¥å‘é€å¤±è´¥
	//
	// for i := 1; i <= 3; i++ {
	//     select {
	//     case ch <- i:
	//         fmt.Printf("  æˆåŠŸå‘é€: %d\n", i)
	//     default:
	//         fmt.Printf("  å‘é€å¤±è´¥: %d (channel å·²æ»¡)\n", i)
	//     }
	// }
	// ä½ çš„ä»£ç :

	// éé˜»å¡æ¥æ”¶
	fmt.Println("\næµ‹è¯•éé˜»å¡æ¥æ”¶:")
	// TODO: ä½¿ç”¨ select + default å®ç°éé˜»å¡æ¥æ”¶
	// å°è¯•æ¥æ”¶ 3 æ¬¡
	// å‰ä¸¤æ¬¡èƒ½æ¥æ”¶åˆ°æ•°æ®ï¼Œç¬¬ä¸‰æ¬¡åº”è¯¥æ¥æ”¶å¤±è´¥
	//
	// for i := 1; i <= 3; i++ {
	//     select {
	//     case val := <-ch:
	//         fmt.Printf("  æ¥æ”¶åˆ°: %d\n", val)
	//     default:
	//         fmt.Println("  æ¥æ”¶å¤±è´¥ (channel ä¸ºç©º)")
	//     }
	// }
	// ä½ çš„ä»£ç :

	// é—®é¢˜æ€è€ƒ:
	// 1. ä»€ä¹ˆæ—¶å€™éœ€è¦éé˜»å¡æ“ä½œï¼Ÿ
	// 2. default å’Œ time.After(0) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
}

// ============================================
// ç»ƒä¹  5: å®æˆ˜ - å¤šæ•°æ®æºèšåˆ ğŸ“Š
// ç›®æ ‡: ä»å¤šä¸ªæ•°æ®æºæ”¶é›†æ•°æ®ï¼Œç»Ÿä¸€å¤„ç†
// é¢è¯•è€ƒç‚¹: å®é™…åº”ç”¨åœºæ™¯
// ============================================
func exercise5() {
	fmt.Println("\nã€ç»ƒä¹  5ã€‘å®æˆ˜ - å¤šæ•°æ®æºèšåˆ")

	// åœºæ™¯: ä»å¤šä¸ª API è·å–æ•°æ®ï¼Œå“ªä¸ªå…ˆè¿”å›å°±ç”¨å“ªä¸ª
	// API 1: å¿«é€Ÿä½†æ•°æ®å¯èƒ½æ—§ (50ms)
	// API 2: æ…¢é€Ÿä½†æ•°æ®æ–° (150ms)
	// API 3: å¤‡ç”¨ API (100ms)

	type Result struct {
		source string
		data   string
	}

	//results := make(chan Result)

	// TODO: æ¨¡æ‹Ÿä¸‰ä¸ª API è°ƒç”¨
	// å¯åŠ¨ä¸‰ä¸ª goroutineï¼Œæ¨¡æ‹Ÿä¸åŒå»¶è¿Ÿçš„ API è°ƒç”¨
	//
	// // API 1: å¿«é€Ÿ
	// go func() {
	//     time.Sleep(50 * time.Millisecond)
	//     results <- Result{"API-1", "å¿«é€Ÿæ•°æ®"}
	// }()
	//
	// // API 2: æ…¢é€Ÿ
	// go func() {
	//     time.Sleep(150 * time.Millisecond)
	//     results <- Result{"API-2", "æœ€æ–°æ•°æ®"}
	// }()
	//
	// // API 3: å¤‡ç”¨
	// go func() {
	//     time.Sleep(100 * time.Millisecond)
	//     results <- Result{"API-3", "å¤‡ç”¨æ•°æ®"}
	// }()
	// ä½ çš„ä»£ç :

	// TODO: ä½¿ç”¨ select è·å–ç¬¬ä¸€ä¸ªè¿”å›çš„ç»“æœ
	// è®¾ç½® 200ms æ€»è¶…æ—¶
	//
	// select {
	// case result := <-results:
	//     fmt.Printf("âœ… ä½¿ç”¨ %s çš„æ•°æ®: %s\n", result.source, result.data)
	// case <-time.After(200 * time.Millisecond):
	//     fmt.Println("âŒ æ‰€æœ‰ API éƒ½è¶…æ—¶äº†")
	// }
	// ä½ çš„ä»£ç :

	time.Sleep(200 * time.Millisecond) // ç­‰å¾…å…¶ä»– goroutine å®Œæˆ

	// é—®é¢˜æ€è€ƒ:
	// 1. å…¶ä»–ä¸¤ä¸ª API çš„ goroutine ä¼šæ€æ ·ï¼Ÿ
	// 2. å¦‚ä½•æ”¹è¿›è®©æ‰€æœ‰ API éƒ½èƒ½æ­£å¸¸å®Œæˆï¼Ÿï¼ˆæç¤º: done channelï¼‰
	// 3. å¦‚æœæƒ³è¦æ”¶é›†æ‰€æœ‰ç»“æœï¼ˆè€Œä¸æ˜¯åªè¦ç¬¬ä¸€ä¸ªï¼‰ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ
}
